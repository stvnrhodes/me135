<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>Websockets!</title>
</head>

<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
  var socket = io.connect(document.URL);
  function onLoad() {
    var speed = 5;
    document.getElementById('speed').innerHTML = speed;
    document.addEventListener('keydown', function(event) {
      if(event.keyCode == 87) {  // 'W'
        socket.emit('move', {id:'m', dir:'f', spd:speed});
      }
      else if(event.keyCode == 65) {  // 'A'
        socket.emit('move', {id:'m', dir:'l', spd:speed});
      }
      else if(event.keyCode == 83) {  // 'S'
        socket.emit('move', {id:'m', dir:'b', spd:speed});
      }
      else if(event.keyCode == 68) {  // 'D'
        socket.emit('move', {id:'m', dir:'r', spd:speed});
      }
      else if(event.keyCode == 32) {  // Space bar
        socket.emit('move', {id:'m', dir:'s', spd:speed});
      }
      else if(event.keyCode == 88) { // 'X'
        if (speed < 10) {
          speed += 1;
        }
        document.getElementById('speed').innerHTML = speed.toString();
      }
      else if(event.keyCode == 90) { // 'Z'
        if (speed > 0) {
          speed -= 1;
        }
        document.getElementById('speed').innerHTML = speed.toString();
      }
    });
    document.addEventListener('keyup', function(event) {
      var k = event.keyCode;
      if(k == 87 || k == 65 || k == 83 || k == 68) {  // 'W'
        socket.emit('move', {id:'m', dir:'s', spd:0});
      }
    });
    document.getElementById('LED1').onclick = function(){socket.emit('led', { id:'l', num: 1 } );};
    document.getElementById('LED2').onclick = function(){socket.emit('led', { id:'l', num: 2 } );};
    document.getElementById('resetEncoder').onclick = function(){socket.emit('enc', {id:'e', action: 'rst'})}
    socket.on('b', function(data) {
      buttonText = document.getElementById('buttonText');
      if (data.val) {
        buttonText.innerHTML = "not pressed";
      } else {
        buttonText.innerHTML = "pressed";
      }
    });
    socket.on('ctr', function(data) {
      document.getElementById('counterText').innerHTML = data.val.toString();
    });
    socket.on('enc', function(data) {
      document.getElementById(data.side).innerHTML = data.val.toString();
    });
  }
</script>

<body onload="onLoad()">
  <div>
    To control direction, use WASD. To control speed, use XZ.
    <table border="0">
      <tr>
        <td>Speed(0-10):</td>
        <td id="speed">0</td>
      </tr>
      <tr>
        <td>Left Encoder Count:</td>
        <td id="lEnc">0</td>
      </tr>
      <tr>
        <td>Right Encoder Count:</td>
        <td id="rEnc">0</td>
    </table>
    <input type="button" id="resetEncoder" value="Reset Encoder Count">
  </div>
  <div>
    <input type="button" id="LED1" value="LED1">
    <input type="button" id="LED2" value="LED2">
  </div>
  <canvas id="robopath" width="200" height="100"></canvas>
</body>
</html>
